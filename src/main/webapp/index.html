<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
		<script src="resources/js/Iconst.js"></script>
		<script src="resources/js/utils/customUtils.js"></script>
		<script src="resources/js/RelationContainer.js"></script>
		<script src="resources/js/business/Items.js"></script>
	</head>

	<body>
		<p>商户id：
			<input id="input-uid" type="number" min="1000" max="9999" value="1000">
			<button id="button-init">查看上架商品</button>
		</p>

		<p></p>
		<div id="container-items">
			<table id="table-items"></table>
		</div>
		<p></p>
		<button id="button-pre">上翻</button>
		<button id="button-next">下翻</button>
		<p id="p-console" style="color: red;">提示字符</p>
		<script>
			$(document).ready(() => {
				let container = qE("#container-items");
				let pConsole = qE("#p-console");
				pConsole.log = function(str, append = false) {
					let textNode = document.createTextNode(str);
					if(append) {
						pConsole.appendChild(textNode);
					} else {
						pConsole.replaceChild(textNode, pConsole.firstChild);
					}
				}
				let itemsPage = {
					curPage: 0,
					init: function() {
						itemsPage.curPage = 0;
						itemsPage.queryAndShow().then(itemsLen => {
							if(itemsLen > 0) {
								pConsole.log(`欢迎来到xx的商铺~`);
							} else {
								pConsole.log(`这里空空如也~`);
							}
						});
					},
					next: function() {
						itemsPage.curPage++;
						itemsPage.queryAndShow().then(itemsLen => {
							if(itemsLen <= 0) {
								pConsole.log(`当前页为第${itemsPage.curPage + 1}页,木有内容了~`);
							} else {
								pConsole.log(`当前页为第${itemsPage.curPage + 1}页`);
							}
						});
					},
					pre: function() {
						if(itemsPage.curPage > 0) {
							itemsPage.curPage--;
							itemsPage.queryAndShow().then(itemsLen => {
								if(itemsLen <= 0) {
									pConsole.log(`当前页为第${itemsPage.curPage + 1}页,木有内容了~`);
								} else {
									pConsole.log(`当前页为第${itemsPage.curPage + 1}页`);
								}
							});
						} else {
							pConsole.log(`前面没有了~`);
						}
					},
					queryAndShow: function() {
						let uid = qE("#input-uid").value;
						return new Promise(resolve => {
							Items.defaultQuery(itemsPage.curPage, uid).then(items => {
								container.replaceChild(Items.toTable(items), container.firstChild);
								resolve(items.length);
							});
						});
					},
				};
				addRel("#button-init", "click", itemsPage.init);
				addRel("#button-next", "click", itemsPage.next);
				addRel("#button-pre", "click", itemsPage.pre);
				itemsPage.init();
			});
		</script>
	</body>

</html>