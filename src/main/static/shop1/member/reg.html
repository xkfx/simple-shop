<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>SIMPLE SHOP</title>
		<link rel="stylesheet" type="text/css" href="../resources/css/style.css" />
		<style>
			main>table {
				margin: 15px 0;
				border: 1px solid black;
			}
			
			main>table td {
				border: 1px solid black;
			}
			
			main .buttons {
				margin: 15px 0;
			}
		</style>
		<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
		<script src="../resources/js/Iconst.js"></script>
		<script src="../resources/js/utils/customUtils.js"></script>
		<script src="../resources/js/RelationContainer.js"></script>
		<script src="../resources/js/business/User.js"></script>
	</head>

	<body>
		<header>
			<h1><a href="" title="返回首页">用户注册</a></h1>
		</header>

		<main>
			<table>
				<tr>
					<td>用户名</td>
					<td><input type="text" name="username" /></td>
				</tr>
				<tr>
					<td>密码</td>
					<td><input type="password" name="password" /></td>
				</tr>
				<tr>
					<td>类型</td>
					<td>
						<label><input type="radio" name="type" value="0" checked />买家</label>
						<label><input type="radio" name="type" value="1" />卖家</label>
						<label><input type="radio" name="type" value="2" />物流</label>
					</td>
				</tr>
			</table>
			<div class="buttons">
				<button name="submit">提交</button>
				<button name="clear">清空</button>
				<button name="jump">已有账号，立即登陆</button>
			</div>
		</main>
		<footer>
			<div id="console">
			</div>
		</footer>

		<script>
			$(document).ready(() => {
				let inputUsername = qE("input[name=username]");
				let inputPwd = qE("input[name=password]");
				let inputTypes = document.querySelectorAll("input[name=type]");
				let btnSubmit = qE(".buttons [name=submit]");
				let btnJump = qE(".buttons [name=jump]");
				let divConsole = qE("#console");

				let ipg = {
					log: function(dom) {
						if(["string", "number"].indexOf(typeof dom) != -1) {
							dom = document.createTextNode(dom);
						}
						divConsole.replaceChild(dom, divConsole.firstChild);
					},
					logError: function(message) {
						let dom = elt("p", {
							style: "color: red;",
						}, message);
						ipg.log(dom);
					},
					getSelectedType: function() {
						for(let x of Array.from(inputTypes)) {
							if(x.checked) {
								return x.value;
							}
						}
					},
					clear: function() {
						inputUsername.value = "";
						inputPwd.value = "";
						inputTypes[0].checked = true;
					},
					regSuccess: function() {
						
					},
					_submit: function() {
						let username = inputUsername.value;
						let pwd = inputPwd.value;
						let type = ipg.getSelectedType();
						User.save(username, pwd, type).then(user => {
							ipg.log("注册成功！");
							
							btnSubmit.disable = true;
//							if(user.type === 1) {
//								let dom = elt("div", {}, "管理你的商品：", elt("a", {
//									href: "../merchant/items.html?userId=" + user.id,
//								}, "url4" + user.id));
//								ipg.log(dom);
//							}
						}).catch(e => {
							ipg.logError("注册失败！" + e.message);
						});
					},
				};
				addRel(btnSubmit, "click", ipg._submit);
				addRel(qE(".buttons [name=clear]"), "click", ipg.clear);
			});
		</script>
	</body>

</html>